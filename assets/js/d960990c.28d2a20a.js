"use strict";(globalThis.webpackChunkcreate_project_docs=globalThis.webpackChunkcreate_project_docs||[]).push([[8961],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var r=s(96540);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}},76539:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"api-specification/backend-api/services","title":"Internal Services","description":"Backend service architecture and implementation details for Sketch2Screen.","source":"@site/docs/api-specification/backend-api/services.md","sourceDirName":"api-specification/backend-api","slug":"/api-specification/backend-api/services","permalink":"/project-001-sketch2screen/docs/api-specification/backend-api/services","draft":false,"unlisted":false,"editUrl":"https://github.com/Capstone-Projects-2025-Fall/project-001-sketch2screen/edit/main/documentation/docs/api-specification/backend-api/services.md","tags":[],"version":"current","lastUpdatedBy":"Sahil-Jartare","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Backend API","permalink":"/project-001-sketch2screen/docs/category/backend-api"},"next":{"title":"API Reference","permalink":"/project-001-sketch2screen/docs/api-specification/backend-api/swagger-api"}}');var i=s(74848),l=s(28453);const c={},o="Internal Services",t={},d=[{value:"Overview",id:"overview",level:2},{value:"Claude Client Service",id:"claude-client-service",level:2},{value:"Functions",id:"functions",level:3},{value:"<code>image_to_html_css()</code>",id:"image_to_html_css",level:4},{value:"<code>_client()</code>",id:"_client",level:4},{value:"<code>_load_anthropic_key_from_file()</code>",id:"_load_anthropic_key_from_file",level:4},{value:"<code>_extract_text()</code>",id:"_extract_text",level:4},{value:"Collaboration Server",id:"collaboration-server",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Functions",id:"functions-1",level:3},{value:"<code>applyDiff(base, diff)</code>",id:"applydiffbase-diff",level:4},{value:"Classes",id:"classes",level:3},{value:"<code>Collaborator</code>",id:"collaborator",level:4},{value:"<code>SingletonMeta</code>",id:"singletonmeta",level:4},{value:"<code>CollabSession</code>",id:"collabsession",level:4},{value:"<code>Sketch</code>",id:"sketch",level:4},{value:"<code>CollabServer</code>",id:"collabserver",level:4},{value:"<code>onNewConnection(userID, collabID)</code>",id:"onnewconnectionuserid-collabid",level:5},{value:"<code>onSceneUpdate(userID, collabID, sketchID, sceneData)</code>",id:"onsceneupdateuserid-collabid-sketchid-scenedata",level:5},{value:"<code>onPageUpdate(userID, collabID, sketchID, pageName)</code>",id:"onpageupdateuserid-collabid-sketchid-pagename",level:5},{value:"<code>onConnectionEnd(userID, collabID)</code>",id:"onconnectionenduserid-collabid",level:5},{value:"<code>sendSceneUpdate(userID, sketchID, sceneData)</code>",id:"sendsceneupdateuserid-sketchid-scenedata",level:5},{value:"<code>sendPageUpdate(userID, sketchID, pageName)</code>",id:"sendpageupdateuserid-sketchid-pagename",level:5},{value:"WebSocket Consumer",id:"websocket-consumer",level:2},{value:"Class: <code>SketchConsumer</code>",id:"class-sketchconsumer",level:3},{value:"WebSocket Protocol",id:"websocket-protocol",level:3},{value:"Key Methods",id:"key-methods",level:3},{value:"<code>connect()</code>",id:"connect",level:4},{value:"<code>disconnect(close_code)</code>",id:"disconnectclose_code",level:4},{value:"<code>receive(text_data)</code>",id:"receivetext_data",level:4},{value:"<code>scene_update(event)</code>, <code>page_update(event)</code>, <code>collaborator_join(event)</code>, <code>collaborator_leave(event)</code>, <code>collaborator_pointer(event)</code>",id:"scene_updateevent-page_updateevent-collaborator_joinevent-collaborator_leaveevent-collaborator_pointerevent",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Django Settings",id:"django-settings",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Claude Client",id:"claude-client",level:3},{value:"Collaboration Server",id:"collaboration-server-1",level:3},{value:"WebSocket Consumer",id:"websocket-consumer-1",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"internal-services",children:"Internal Services"})}),"\n",(0,i.jsx)(n.p,{children:"Backend service architecture and implementation details for Sketch2Screen."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The backend consists of three main service components:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Claude Client"})," - AI-powered sketch-to-code generation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Collaboration Server"})," - Real-time session and state management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"WebSocket Consumer"})," - WebSocket message handling"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"claude-client-service",children:"Claude Client Service"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Module:"})," ",(0,i.jsx)(n.code,{children:"backend/sketch_api/services/claudeClient.py"})]}),"\n",(0,i.jsx)(n.p,{children:"The Claude Client service handles all interactions with the Anthropic Claude API for AI-powered sketch-to-code generation."}),"\n",(0,i.jsx)(n.h3,{id:"functions",children:"Functions"}),"\n",(0,i.jsx)(n.h4,{id:"image_to_html_css",children:(0,i.jsx)(n.code,{children:"image_to_html_css()"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Main entry point for converting sketch images to HTML/CSS using Claude AI."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def image_to_html_css(\n    image_bytes: bytes,\n    media_type: str = "image/png",\n    prompt: Optional[str] = None\n) -> str\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This is an ",(0,i.jsx)(n.strong,{children:"async function"})," and must be awaited."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"image_bytes"})," (bytes) - Raw binary data of the image file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"media_type"})," (str, optional) - MIME type of the image (default: ",(0,i.jsx)(n.code,{children:'"image/png"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prompt"})," (str | None, optional) - Custom user instruction for code generation (default: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"str"})," - Generated HTML and CSS code"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Raises:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RuntimeError"})," - If API key is missing or Claude returns no text"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FileNotFoundError"})," - If API key file path is invalid"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sketch_api.services.claudeClient import image_to_html_css\nimport asyncio\n\n# Read image file\nwith open('sketch.png', 'rb') as f:\n    image_bytes = f.read()\n\n# Generate HTML/CSS (must await)\nhtml = await image_to_html_css(\n    image_bytes=image_bytes,\n    media_type=\"image/png\",\n    prompt=\"Make this design responsive\"\n)\n\nprint(html)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Base64 Encoding"})," - Converts image bytes to base64 string"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prompt Construction"})," - Combines system message with user instruction"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Call"})," - Sends image + prompt to Claude via Anthropic SDK"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Response Parsing"})," - Extracts text content from Claude response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation"})," - Ensures response is not empty"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"System Prompt:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"You are an expert frontend developer specializing in converting UI sketches into\nmodern, high-fidelity, pixel-perfect, production-ready HTML with Tailwind CSS. Your code is clean, semantic,\naccessible, and follows modern web development best practices.\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Default User Instruction:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Convert the provided UI sketch into complete, functional HTML with Tailwind CSS styling.\n\nCRITICAL OUTPUT REQUIREMENTS:\n- Ignore the outer bounding box of sketch as it is for user to assume as a viewport.\n- Return ONLY raw HTML code - no markdown fences, no explanations, no preamble\n- This renders in an iframe, so include complete document structure with <!DOCTYPE html>\n- Set body to full viewport dimensions: class="h-screen w-screen" (100vh height, 100vw width)\n- Do not add padding to outside of the borders, only use spacing within the layout itself\n- Ensure the color scheme matches the sketch.\n\nCODE QUALITY STANDARDS:\n- Design generated should be of extremely high fidelity.\n- Use semantic HTML5 elements (<header>, <nav>, <main>, <section>, <article>, <footer>)\n- Include all necessary JavaScript for interactivity (e.g., dropdowns, modals, tabs)\n- Minimize unnecessary wrapper divs - keep markup lean\n- Ensure all elements have explicit dimensions or content to render properly\n- Make layouts responsive using Tailwind\'s responsive prefixes (sm:, md:, lg:)\n- The design should look production-ready, not like a prototype\n\nDESIGN FIDELITY:\n- Match the sketch\'s layout and color scheme but make it modern, clean, and visually appealing\n- If elements are labeled with HTML tag names (e.g., "button", "input", "img"), use those exact tags\n- Preserve all text content visible in the sketch\n- For images in the design: Use placeholder divs or external placeholder images\n- Represent icons using emoji, Unicode symbols, or labeled boxes\n\nBegin your response with <!DOCTYPE html> and nothing else.\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Model:"})," ",(0,i.jsx)(n.code,{children:"claude-haiku-4-5-20251001"})," (configurable via ",(0,i.jsx)(n.code,{children:"CLAUDE_MODEL"})," setting)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Max Tokens:"})," 15000"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Key:"})," Loaded from file or environment variable"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"_client",children:(0,i.jsx)(n.code,{children:"_client()"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Internal helper to create authenticated Anthropic client."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def _client() -> AsyncAnthropic\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AsyncAnthropic"})," - Authenticated async API client instance"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Raises:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RuntimeError"})," - If API key is not configured"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"API Key Loading Strategy:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Try to load from file specified in ",(0,i.jsx)(n.code,{children:"CLAUDE_API_KEY"})," setting"]}),"\n",(0,i.jsxs)(n.li,{children:["If file fails, try ",(0,i.jsx)(n.code,{children:"ANTHROPIC_API_KEY"})," environment variable"]}),"\n",(0,i.jsxs)(n.li,{children:["If both fail, raise ",(0,i.jsx)(n.code,{children:"RuntimeError"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'client = _client()\nresponse = client.messages.create(\n    model="claude-sonnet-4-20250514",\n    max_tokens=1000,\n    messages=[...]\n)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"_load_anthropic_key_from_file",children:(0,i.jsx)(n.code,{children:"_load_anthropic_key_from_file()"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Internal helper to read API key from file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def _load_anthropic_key_from_file() -> str\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"str"})," - API key (whitespace trimmed)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Raises:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RuntimeError"})," - If ",(0,i.jsx)(n.code,{children:"CLAUDE_API_KEY"})," setting is not configured"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RuntimeError"})," - If API key file is empty"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FileNotFoundError"})," - If file path doesn't exist"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PermissionError"})," - If file cannot be read"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Django Settings:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# settings.py\nCLAUDE_API_KEY = "/path/to/api_key.txt"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"_extract_text",children:(0,i.jsx)(n.code,{children:"_extract_text()"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Internal helper to extract text from Claude API response."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def _extract_text(resp) -> str\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resp"})," (Message) - Anthropic API response object"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"str"})," - Concatenated text from all text-type content blocks"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Response Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Claude response object\n{\n    "content": [\n        {"type": "text", "text": "<div>HTML code here</div>"},\n        {"type": "text", "text": "<style>CSS here</style>"}\n    ]\n}\n\n# Extracted result\n"<div>HTML code here</div><style>CSS here</style>"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"collaboration-server",children:"Collaboration Server"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Module:"})," ",(0,i.jsx)(n.code,{children:"backend/sketch_api/CollabServer.py"})]}),"\n",(0,i.jsx)(n.p,{children:"The Collaboration Server manages real-time collaboration sessions using the Singleton pattern."}),"\n",(0,i.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           CollabServer (Singleton)              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  collabSessions: {                              \u2502\n\u2502    "12345": CollabSession {                     \u2502\n\u2502      members: ["user1", "user2", "user3"]       \u2502\n\u2502      sketches: [                                \u2502\n\u2502        Sketch { ID, name, sceneData }           \u2502\n\u2502      ]                                          \u2502\n\u2502    }                                            \u2502\n\u2502  }                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,i.jsx)(n.h3,{id:"functions-1",children:"Functions"}),"\n",(0,i.jsx)(n.h4,{id:"applydiffbase-diff",children:(0,i.jsx)(n.code,{children:"applyDiff(base, diff)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Apply a differential update to a base scene object, merging changes recursively."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def applyDiff(base, diff)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"base"})," (dict | list | any) - The base scene data to apply changes to"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"diff"})," (dict | list | any) - The differential changes to apply"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dict | list | any"})," - Merged result with diff applied to base"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Converts lists to dicts with string indices for uniform processing"}),"\n",(0,i.jsx)(n.li,{children:"Recursively merges diff into base"}),"\n",(0,i.jsx)(n.li,{children:"Preserves base values not mentioned in diff"}),"\n",(0,i.jsx)(n.li,{children:"Adds new keys from diff not in base"}),"\n",(0,i.jsx)(n.li,{children:"Converts back to list if original was list"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'base = {"elements": [{"id": "1", "x": 10}], "appState": {"zoom": 1}}\ndiff = {"elements": {"0": {"x": 20}}}  # Update x coordinate of first element\n\nresult = applyDiff(base, diff)\n# Result: {"elements": [{"id": "1", "x": 20}], "appState": {"zoom": 1}}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Case:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Efficiently synchronize scene changes without sending entire scene"}),"\n",(0,i.jsx)(n.li,{children:"Reduces network payload for collaboration updates"}),"\n",(0,i.jsx)(n.li,{children:"Prevents mid-stroke conflicts by only sending deltas"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"classes",children:"Classes"}),"\n",(0,i.jsx)(n.h4,{id:"collaborator",children:(0,i.jsx)(n.code,{children:"Collaborator"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Represents a user participating in a collaboration session."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Constructor:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def __init__(self, userID, username, channelName):\n    self.userID = userID\n    self.username = username\n    self.channelName = channelName\n    self.pointer = None\n    self.currentPage = None\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Client-generated unique identifier"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"username"})," (str) - Display name for this user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channelName"})," (str) - Django Channels WebSocket identifier (internal)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pointer"})," (dict | None) - Current cursor position ",(0,i.jsx)(n.code,{children:"{x, y}"})," or ",(0,i.jsx)(n.code,{children:"None"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"currentPage"})," (str | None) - ID of the page user is currently viewing"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'collaborator = Collaborator(\n    userID="user-1234567890-abc123",\n    username="Alice",\n    channelName="specific.channel.xyz789"\n)\ncollaborator.pointer = {"x": 150, "y": 200}\ncollaborator.currentPage = "page-1"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"singletonmeta",children:(0,i.jsx)(n.code,{children:"SingletonMeta"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Metaclass that implements the Singleton design pattern."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class MyClass(metaclass=SingletonMeta):\n    pass\n\ninstance1 = MyClass()\ninstance2 = MyClass()\n\nassert instance1 is instance2  # True - same instance\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class SingletonMeta(type):\n    _instance = None\n\n    def __call__(cls, *args, **kwargs):\n        if cls._instance == None:\n            cls._instance = super(SingletonMeta, cls).__call__(*args, **kwargs)\n        return cls._instance\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"collabsession",children:(0,i.jsx)(n.code,{children:"CollabSession"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Represents a single collaboration session."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"members"})," (list[str]) - List of connected user channel names"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sketches"})," (list[Sketch]) - List of sketch objects in this session"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'session = CollabSession()\nsession.members = ["specific.channel.abc123", "specific.channel.def456"]\nsession.sketches = [\n    Sketch("Homepage", "page-1", {...}),\n    Sketch("About", "page-2", {...})\n]\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"sketch",children:(0,i.jsx)(n.code,{children:"Sketch"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Represents a single sketch/page within a collaboration session."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Constructor:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def __init__(self, name, ID, sceneData):\n    self.name = name\n    self.ID = ID\n    self.sceneData = sceneData\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"})," (str) - Display name of the sketch page"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ID"})," (str | int) - Unique identifier for the sketch"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sceneData"})," (dict) - Excalidraw scene data (elements, appState, etc.)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'sketch = Sketch(\n    name="Contact Page",\n    ID="page-3",\n    sceneData={\n        "elements": [...],\n        "appState": {...}\n    }\n)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"collabserver",children:(0,i.jsx)(n.code,{children:"CollabServer"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Singleton server managing all collaboration sessions and message routing."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Metaclass:"})," ",(0,i.jsx)(n.code,{children:"SingletonMeta"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabSessions"})," (dict) - Maps ",(0,i.jsx)(n.code,{children:"collabID"})," \u2192 ",(0,i.jsx)(n.code,{children:"CollabSession"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Methods:"})}),"\n",(0,i.jsx)(n.h5,{id:"onnewconnectionuserid-collabid",children:(0,i.jsx)(n.code,{children:"onNewConnection(userID, collabID)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Handle new user connecting to a collaboration session."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Channel name of the connecting user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabID"})," (str) - Collaboration session ID"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Creates new session if it doesn't exist"}),"\n",(0,i.jsx)(n.li,{children:"Adds user to session members list"}),"\n",(0,i.jsx)(n.li,{children:"Sends all existing sketches to the new user"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'server = CollabServer()\nserver.onNewConnection("specific.channel.abc123", "12345")\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"onsceneupdateuserid-collabid-sketchid-scenedata",children:(0,i.jsx)(n.code,{children:"onSceneUpdate(userID, collabID, sketchID, sceneData)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Handle scene update from a user."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Channel name of the user sending update"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabID"})," (str) - Collaboration session ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sketchID"})," (str) - ID of the sketch being updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sceneData"})," (dict) - New scene data"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Validates sketch exists in session (discards if not found)"}),"\n",(0,i.jsx)(n.li,{children:"Updates stored scene data"}),"\n",(0,i.jsxs)(n.li,{children:["Broadcasts update to all members ",(0,i.jsx)(n.strong,{children:"except sender"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'server.onSceneUpdate(\n    userID="specific.channel.abc123",\n    collabID="12345",\n    sketchID="page-1",\n    sceneData={"elements": [...], "appState": {...}}\n)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"onpageupdateuserid-collabid-sketchid-pagename",children:(0,i.jsx)(n.code,{children:"onPageUpdate(userID, collabID, sketchID, pageName)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Handle page create, rename, or delete operation."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Channel name of the user sending update"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabID"})," (str) - Collaboration session ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sketchID"})," (str) - ID of the sketch page"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pageName"})," (str | None) - New name, or ",(0,i.jsx)(n.code,{children:"None"})," to delete"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"If sketch not found:"})," Creates new sketch with empty scene data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["If ",(0,i.jsx)(n.code,{children:"pageName"})," is ",(0,i.jsx)(n.code,{children:"None"}),":"]})," Deletes sketch from session"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Otherwise:"})," Updates sketch name"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Create/rename page\nserver.onPageUpdate("user1", "12345", "page-2", "About Us")\n\n# Delete page\nserver.onPageUpdate("user1", "12345", "page-2", None)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"onconnectionenduserid-collabid",children:(0,i.jsx)(n.code,{children:"onConnectionEnd(userID, collabID)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Handle user disconnecting from session."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Channel name of the disconnecting user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabID"})," (str) - Collaboration session ID"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Removes user from session members list"}),"\n",(0,i.jsx)(n.li,{children:"If session has no remaining members, deletes the entire session"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'server.onConnectionEnd("specific.channel.abc123", "12345")\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"sendsceneupdateuserid-sketchid-scenedata",children:(0,i.jsx)(n.code,{children:"sendSceneUpdate(userID, sketchID, sceneData)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Send scene update message to a specific user via Django Channels."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Target user channel name"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sketchID"})," (str) - ID of the updated sketch"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sceneData"})," (dict) - Updated scene data"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'server.sendSceneUpdate(\n    userID="specific.channel.def456",\n    sketchID="page-1",\n    sceneData={"elements": [...]}\n)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Internally uses:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async_to_sync(get_channel_layer().send)(userID, {\n    "type": "scene.update",\n    "sketchID": sketchID,\n    "sketchData": sceneData\n})\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h5,{id:"sendpageupdateuserid-sketchid-pagename",children:(0,i.jsx)(n.code,{children:"sendPageUpdate(userID, sketchID, pageName)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Send page update message to a specific user."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userID"})," (str) - Target user channel name"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sketchID"})," (str) - ID of the updated sketch"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pageName"})," (str | None) - New name or ",(0,i.jsx)(n.code,{children:"None"})," for deletion"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'server.sendPageUpdate(\n    userID="specific.channel.def456",\n    sketchID="page-2",\n    pageName="Contact"\n)\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"websocket-consumer",children:"WebSocket Consumer"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Module:"})," ",(0,i.jsx)(n.code,{children:"backend/sketch_api/consumers.py"})]}),"\n",(0,i.jsx)(n.p,{children:"Handles WebSocket connections and routes messages to CollabServer."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"WebSocket Endpoint:"})," ",(0,i.jsx)(n.code,{children:"ws://localhost:8000/ws/collab/{collabID}/"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This is an experimental feature and may have bugs."]}),"\n",(0,i.jsxs)(n.h3,{id:"class-sketchconsumer",children:["Class: ",(0,i.jsx)(n.code,{children:"SketchConsumer"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Inherits:"})," ",(0,i.jsx)(n.code,{children:"channels.generic.websocket.WebsocketConsumer"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Attributes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server"})," (CollabServer) - Singleton instance (class variable)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collabID"})," (str) - Collaboration ID for this connection (instance variable)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"websocket-protocol",children:"WebSocket Protocol"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Connection Lifecycle:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Client connects \u2192 Server calls ",(0,i.jsx)(n.code,{children:"onNewConnection(channelName, collabID)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Server sends existing state \u2192 Client receives all current pages via ",(0,i.jsx)(n.code,{children:"page_update"})," and ",(0,i.jsx)(n.code,{children:"scene_update"}),", plus existing collaborators via ",(0,i.jsx)(n.code,{children:"collaborator_join"})]}),"\n",(0,i.jsxs)(n.li,{children:["Client sends ",(0,i.jsx)(n.code,{children:"collaborator_join"})," \u2192 Server broadcasts new user to others"]}),"\n",(0,i.jsx)(n.li,{children:"Client sends updates \u2192 Server broadcasts scene diffs to other members (excluding sender)"}),"\n",(0,i.jsxs)(n.li,{children:["Client disconnects \u2192 Server calls ",(0,i.jsx)(n.code,{children:"onConnectionEnd(channelName, collabID)"}),", sends ",(0,i.jsx)(n.code,{children:"collaborator_leave"})," to others, and cleans up if last member"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Message Types (Client \u2192 Server):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scene_update"})," - Scene drawing changes (with diff for efficiency)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"page_update"})," - Page create/rename/delete (null name = delete)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_join"})," - User joined with userID and username"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_pointer"})," - Cursor position update (throttled to 50ms, includes pageID)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Message Types (Server \u2192 Client):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scene_update"})," - Another user's drawing changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"page_update"})," - Another user's page operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_join"})," - New user joined the session"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_leave"})," - User disconnected"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_pointer"})," - Another user's cursor moved (filtered by pageID)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-methods",children:"Key Methods"}),"\n",(0,i.jsx)(n.h4,{id:"connect",children:(0,i.jsx)(n.code,{children:"connect()"})}),"\n",(0,i.jsxs)(n.p,{children:["Extracts ",(0,i.jsx)(n.code,{children:"collabID"})," from URL route, calls ",(0,i.jsx)(n.code,{children:"server.onNewConnection()"}),", accepts WebSocket connection."]}),"\n",(0,i.jsx)(n.h4,{id:"disconnectclose_code",children:(0,i.jsx)(n.code,{children:"disconnect(close_code)"})}),"\n",(0,i.jsxs)(n.p,{children:["Calls ",(0,i.jsx)(n.code,{children:"server.onConnectionEnd()"})," to clean up session."]}),"\n",(0,i.jsx)(n.h4,{id:"receivetext_data",children:(0,i.jsx)(n.code,{children:"receive(text_data)"})}),"\n",(0,i.jsxs)(n.p,{children:["Parses JSON message, routes based on ",(0,i.jsx)(n.code,{children:"action"})," field to:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scene_update"})," \u2192 ",(0,i.jsx)(n.code,{children:"onSceneUpdate()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"page_update"})," \u2192 ",(0,i.jsx)(n.code,{children:"onPageUpdate()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_join"})," \u2192 ",(0,i.jsx)(n.code,{children:"onCollaboratorJoin()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"collaborator_pointer"})," \u2192 ",(0,i.jsx)(n.code,{children:"onCollaboratorPointer()"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"scene_updateevent-page_updateevent-collaborator_joinevent-collaborator_leaveevent-collaborator_pointerevent",children:[(0,i.jsx)(n.code,{children:"scene_update(event)"}),", ",(0,i.jsx)(n.code,{children:"page_update(event)"}),", ",(0,i.jsx)(n.code,{children:"collaborator_join(event)"}),", ",(0,i.jsx)(n.code,{children:"collaborator_leave(event)"}),", ",(0,i.jsx)(n.code,{children:"collaborator_pointer(event)"})]}),"\n",(0,i.jsx)(n.p,{children:"Django Channels handlers that serialize events and send to WebSocket client."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Message Flow:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Client sends\n{"action": "scene_update", "sketchID": "page-1", "sketchData": {...}}\n\n# Server broadcasts to others\n{"action": "scene_update", "sketchID": "page-1", "sketchData": {...}}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"django-settings",children:"Django Settings"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Required:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# settings.py\n\n# Claude API key file path or use ANTHROPIC_API_KEY env var\nCLAUDE_API_KEY = "/path/to/api_key.txt"\n\n# Optional: Claude model to use (default shown)\nCLAUDE_MODEL = "claude-sonnet-4-20250514"\n\n# Channel layers for WebSocket\nCHANNEL_LAYERS = {\n    "default": {\n        "BACKEND": "channels.layers.InMemoryChannelLayer"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Environment Variables:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Alternative to CLAUDE_API_KEY setting\nexport ANTHROPIC_API_KEY="sk-ant-..."\n\n# Set to True for production mode\nexport PROD=True\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"claude-client",children:"Claude Client"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Synchronous API calls"})," - Blocks request thread during generation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Average response time:"})," 3-10 seconds per image"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token limit:"})," 2000 tokens per response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Rate limits:"})," Depends on Anthropic API plan"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Optimization Ideas:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use async/await for non-blocking requests"}),"\n",(0,i.jsx)(n.li,{children:"Implement request queuing for high traffic"}),"\n",(0,i.jsx)(n.li,{children:"Cache common sketch patterns"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"collaboration-server-1",children:"Collaboration Server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"In-memory storage"})," - Fast but ephemeral"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No persistence"})," - All data lost on restart"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single-instance limitation"})," - InMemoryChannelLayer doesn't scale horizontally"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scaling Recommendations:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use Redis channel layer for multi-server deployments"}),"\n",(0,i.jsx)(n.li,{children:"Implement database persistence for sketches"}),"\n",(0,i.jsx)(n.li,{children:"Add session expiration and cleanup"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"websocket-consumer-1",children:"WebSocket Consumer"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"One consumer instance per connection"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message broadcasting"})," - O(n) where n = number of session members"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No message buffering"})," - Messages sent immediately"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);